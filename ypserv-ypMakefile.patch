--- ypserv-2.5/scripts/ypMakefile.in~	Thu Sep 12 22:38:41 2002
+++ ypserv-2.5/scripts/ypMakefile.in	Thu Sep 12 23:10:13 2002
@@ -37,11 +37,11 @@
 
 # Should we merge the passwd file with the shadow file ?
 # MERGE_PASSWD=true|false
-MERGE_PASSWD=true
+MERGE_PASSWD=false
 
 # Should we merge the group file with the gshadow file ?
 # MERGE_GROUP=true|false
-MERGE_GROUP=true
+MERGE_GROUP=false
 
 # These are commands which this Makefile needs to properly rebuild the
 # NIS databases. Don't change these unless you have a good reason.
@@ -92,6 +92,7 @@
 TIMEZONE    = $(YPSRCDIR)/timezone
 LOCALE      = $(YPSRCDIR)/locale
 NETMASKS    = $(YPSRCDIR)/netmasks
+OLDPASSWD   = $(YPSRCDIR)/security/opasswd
 
 YPSERVERS = $(YPDIR)/ypservers	# List of all NIS servers for a domain
 
@@ -105,7 +106,7 @@
 # them out from this list.
 
 all:  passwd group hosts rpc services netid protocols netgrp mail \
-	shadow publickey # networks ethers bootparams printcap \
+	shadow opasswd #publickey # networks ethers bootparams printcap \
 	# amd.home auto.master auto.home auto.local passwd.adjunct \
 	# timezone locale netmasks
 
@@ -142,6 +143,7 @@
 timezone:      timezone.byname
 locale:                locale.byname
 netmasks:      netmasks.byaddr
+opasswd:       opasswd.byname opasswd.byuid
 
 ypservers: $(YPSERVERS) $(YPDIR)/Makefile
 	@echo "Updating $@..."
@@ -444,6 +446,22 @@
 		}' | $(DBLOAD) -i $(AMD_HOME) -o $(YPMAPDIR)/$@ - $@
 	-@$(NOPUSH) || $(YPPUSH) -d $(DOMAIN) $@
 
+opasswd.byname: $(OLDPASSWD) $(YPDIR)/Makefile
+	@echo "Updating $@..."
+	@$(UMASK); \
+	$(AWK) -F: '!/^[-+#]/ { if ($$1 != "" && $$2 >= $(MINUID) ) \
+		print $$1"\t"$$0 }' $(OLDPASSWD) | $(DBLOAD) -i $(OLDPASSWD) \
+		-o $(YPMAPDIR)/$@ - $@
+	-@$(NOPUSH) || $(YPPUSH) -d $(DOMAIN) $@
+
+opasswd.byuid: $(OLDPASSWD) $(YPDIR)/Makefile
+	@echo "Updating $@..."
+	@$(UMASK); \
+	$(AWK) -F: '!/^[-+#]/ { if ($$1 != "" && $$2 >= $(MINUID) ) \
+	print $$2"\t"$$0 }' $(OLDPASSWD) | $(DBLOAD) -i $(OLDPASSWD) \
+	-o $(YPMAPDIR)/$@ - $@
+	-@$(NOPUSH) || $(YPPUSH) -d $(DOMAIN) $@
+
 timezone.byname: $(TIMEZONE) $(YPDIR)/Makefile
 	@echo "Updating $@..."
 	@$(AWK) '{ if ($$1 != "" && $$1 !~ "#") \
